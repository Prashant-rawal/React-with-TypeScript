<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/React-with-TypeScript/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/React-with-TypeScript/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/React-with-TypeScript/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/React-with-TypeScript/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/React-with-TypeScript/images/favicon.ico"/><title>The Context Api – React with TypeScript</title><meta name="description" content="A workshop for start using TypeScript with React"/><meta name="keywords" content="React,react,TypeScript,workshop,Prashant Rawal"/><meta name="og:description" content="A workshop for start using TypeScript with React"/><meta name="og:title" content="The Context Api – React with TypeScript"/><meta name="og:image" content="/React-with-TypeScript/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/React-with-TypeScript/_next/static/css/b0d5392bbfae9df4.css" as="style"/><link rel="stylesheet" href="/React-with-TypeScript/_next/static/css/b0d5392bbfae9df4.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/React-with-TypeScript/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/React-with-TypeScript/_next/static/chunks/webpack-1a3481fa144e7432.js" defer=""></script><script src="/React-with-TypeScript/_next/static/chunks/framework-305cb810cde7afac.js" defer=""></script><script src="/React-with-TypeScript/_next/static/chunks/main-f3c3a156ab1ad8c6.js" defer=""></script><script src="/React-with-TypeScript/_next/static/chunks/pages/_app-c7df7ff57dad61ea.js" defer=""></script><script src="/React-with-TypeScript/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-9ab3041fb81318ea.js" defer=""></script><script src="/React-with-TypeScript/_next/static/PALjGKd3AshwdXjsrKNVy/_buildManifest.js" defer=""></script><script src="/React-with-TypeScript/_next/static/PALjGKd3AshwdXjsrKNVy/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/React-with-TypeScript">React with TypeScript</a></h1><div class="navbar-info"></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><h1 id="context-api"><strong>Context Api</strong></h1>
<p>At first glance, React&#39;s Context API behaves just like we might expect.</p>
<pre><code class="language-tsx">import { createContext } from &quot;react&quot;;
import { initialState } from &quot;./lib/color-reducer&quot;;

const ColorContext = createContext(initialState);
</code></pre>
<p>If you hover over <code>ColorContext</code>, you&#39;ll see:</p>
<pre><code class="language-tsx">const ColorContext: React.Context&lt;ColorState&gt;;
</code></pre>
<p>And if you <em>just</em> needed that you&#39;d be fine.</p>
<p><img src="_attachments/Pasted%20image%2020221111145036.png" alt=""></p>
<p>The problem is that a lot of the time we use the Context APi to help with state management. And part of state management is—you know—updating the state.</p>
<p>And to update the state, you tend to use hooks. And you definitely don&#39;t have those hooks outside of components.</p>
<p>The is futher exacerbated by the fact that you can only export <code>ColorContext</code> from the top-level of the module (e.g. <em>not</em> inside a component where you can use hooks).</p>
<p>And so, it&#39;s a bit tempting to say that we want to do something like this:</p>
<pre><code class="language-tsx">const ColorContext = createContext&lt;{
  state: ColorState;
  dispatch: Dispatch&lt;ColorActions&gt;;
}&gt;({ state: initialState });
</code></pre>
<p>The problem of course is that you know you&#39;re going to get yelled at for not having <code>dispatch</code> just yet.</p>
<p><img src="_attachments/Pasted%20image%2020221111145603.png" alt=""></p>
<p>One option is to make <code>dispatch</code> optional, but then you&#39;re going to have to confirm it&#39;s existence <em>every</em> time you use it—and that <em>not</em> ideal.</p>
<pre><code class="language-tsx">const ColorContext = createContext&lt;{
  state: ColorState;
  dispatch?: Dispatch&lt;ColorActions&gt;;
}&gt;({ state: initialState });
</code></pre>
<p>We&#39;re going to arrive at a slightly better solution in a bit, but we need to learn a few more things. But, one option is that since we <em>know</em> that we&#39;re immediately going to write up <code>dispatch</code> (or, <code>useState</code>), we could tell TypeScript, &quot;Hey, trust me, I know what I&#39;m doing.&quot;</p>
<h2 id="ideas-that-i-am-not-willing-to-entertain">Ideas that I am not willing to entertain</h2>
<ul>
<li><strong>Using <code>any</code></strong>: This will opt us out of the whole reason we&#39;re using TypeScript in the first place.</li>
</ul>
<h2 id="an-escape-hatch">An escape hatch</h2>
<p>This is an escape hatch that should fill you with an icky feeling, but it&#39;s mostly okay in this particular case. We can assert that an object meets a given type—even if TypeScript doesn&#39;t think that it does.</p>
<p>We did this already in <code>src/index.tsx</code></p>
<pre><code class="language-tsx">const root = ReactDOM.createRoot(
  document.getElementById(&quot;root&quot;) as HTMLElement
);
</code></pre>
<p>See that <code>as HTMLElement</code>. Yea, like there is a chance that it&#39;s not on the page. <code>document.getElementById()</code> handles that telling you that it <em>might</em> return <code>undefined</code>.</p>
<p>But, we <em>know</em> it&#39;s on the page, so we told TypeScript that it&#39;s cool. We can do the same thing here too.</p>
<pre><code class="language-ts">const ColorContext = createContext({ state: initialState } as {
  state: ColorState;
  dispatch: Dispatch&lt;ColorActions&gt;;
});
</code></pre>
<!-- If this bother's you, we'll look at [a different—and arguably, better—way](createContext.md) to deal with this after we explore [generics](Generics.md) in a bit. -->

<p>Now, we can go the rest of the way with the normal ceremony that we&#39;re used to.</p>
<pre><code class="language-ts">import { createContext, Dispatch, PropsWithChildren, useReducer } from &quot;react&quot;;
import colorReducer, { initialState } from &quot;./lib/color-reducer&quot;;

export const ColorContext = createContext({ state: initialState } as {
  state: ColorState;
  dispatch: Dispatch&lt;ColorActions&gt;;
});

export const ColorProvider = ({ children }: PropsWithChildren) =&gt; {
  const [state, dispatch] = useReducer(colorReducer, initialState);

  return (
    &lt;ColorContext.Provider value={{ state, dispatch }}&gt;
      {children}
    &lt;/ColorContext.Provider&gt;
  );
};
</code></pre>
<p>Don&#39;t forget to wrap your application in</p>
<p>The important thing to note is that despite our sneaky move, our type system holds up. We don&#39;t have to verify that <code>dispatch</code> exists constantly and when we go to use <code>state</code> and <code>dispatch</code>, everything will have the correct types.</p>
<h2 id="using-the-context-in-your-components">Using the context in your components</h2>
<p>And again, we get a lot of the types for free. Let&#39;s take it for a spin in <code>src/components/shared/color-change-swatch.tsx</code>.</p>
<pre><code class="language-tsx">import clsx from &quot;clsx&quot;;
import { MouseEventHandler, useContext } from &quot;react&quot;;
import { ColorContext } from &quot;../../context&quot;;
import Button from &quot;./button&quot;;

type ColorChangeSwatchProps = {
  hexColor: string;
  className?: string;
  onClick?: MouseEventHandler&lt;HTMLButtonElement&gt;;
};

const ColorChangeSwatch = ({
  hexColor,
  className,
  onClick,
}: ColorChangeSwatchProps) =&gt; {
  const { dispatch } = useContext(ColorContext);

  return (
    &lt;Button
      className={clsx(
        &quot;border-2 border-slate-900 transition-shadow duration-200 ease-in hover:shadow-xl&quot;,
        className
      )}
      style={{ backgroundColor: hexColor }}
      onClick={() =&gt;
        dispatch({ type: &quot;update-hex-color&quot;, payload: { hexColor } })
      }
    &gt;
      {hexColor}
    &lt;/Button&gt;
  );
};

export default ColorChangeSwatch;
</code></pre>
<p>We can and should unwind the passing through of the <code>onClick</code> prop, but it&#39;s not bothering anyone for now and I&#39;ll probably just do that behind the seens as not to waste your precious time.</p>
<h2 id="wiring-up-our-new-state">Wiring up our new state</h2>
<p>Now, it both works and it doesn&#39;t work at the same time. It totally works, but <code>src/components/application.tsx</code> is using a <em>different</em> reducer right now.</p>
<p>This is an easy fix:</p>
<pre><code class="language-tsx">const Application = () =&gt; {
  const { state, dispatch } = useContext(ColorContext);
  const hexColor = state.hexColor;

  return (
    &lt;div className=&quot;grid max-w-3xl grid-cols-1 gap-8 p-8 pb-40 mx-auto dark:bg-slate-900 dark:text-white sm:grid-cols-2&quot;&gt;
      &lt;ColorPicker
        hexColor={hexColor}
        onChange={(e) =&gt;
          dispatch({
            type: &quot;update-hex-color&quot;,
            payload: { hexColor: e.target.value },
          })
        }
      /&gt;
      &lt;AdjustColors hexColor={hexColor} dispatch={dispatch} /&gt;
      &lt;RelatedColors hexColor={hexColor} /&gt;
      &lt;SavedColors hexColor={hexColor} dispatch={dispatch} /&gt;
    &lt;/div&gt;
  );
};
</code></pre>
</div><div class="lesson-links"><a href="/React-with-TypeScript/lessons/Reducers/Typing-action-and-reducers-solution" class="prev">← Previous</a><a href="/React-with-TypeScript/lessons/context-api/context-api-exercise" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><footer class="footer"><ul class="socials"><li class="social"><a href="https://github.com/https://github.com/IAmCuriousDeveloper"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/https://in.linkedin.com/in/prashant-rawal-12142b117"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://in.linkedin.com/in/prashant-rawal-12142b117">Prashant Rawal</a></p><p>Please respect the creator</p></div></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{},"html":"\u003ch1 id=\"context-api\"\u003e\u003cstrong\u003eContext Api\u003c/strong\u003e\u003c/h1\u003e\n\u003cp\u003eAt first glance, React\u0026#39;s Context API behaves just like we might expect.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport { createContext } from \u0026quot;react\u0026quot;;\nimport { initialState } from \u0026quot;./lib/color-reducer\u0026quot;;\n\nconst ColorContext = createContext(initialState);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eIf you hover over \u003ccode\u003eColorContext\u003c/code\u003e, you\u0026#39;ll see:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst ColorContext: React.Context\u0026lt;ColorState\u0026gt;;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd if you \u003cem\u003ejust\u003c/em\u003e needed that you\u0026#39;d be fine.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"_attachments/Pasted%20image%2020221111145036.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThe problem is that a lot of the time we use the Context APi to help with state management. And part of state management is—you know—updating the state.\u003c/p\u003e\n\u003cp\u003eAnd to update the state, you tend to use hooks. And you definitely don\u0026#39;t have those hooks outside of components.\u003c/p\u003e\n\u003cp\u003eThe is futher exacerbated by the fact that you can only export \u003ccode\u003eColorContext\u003c/code\u003e from the top-level of the module (e.g. \u003cem\u003enot\u003c/em\u003e inside a component where you can use hooks).\u003c/p\u003e\n\u003cp\u003eAnd so, it\u0026#39;s a bit tempting to say that we want to do something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst ColorContext = createContext\u0026lt;{\n  state: ColorState;\n  dispatch: Dispatch\u0026lt;ColorActions\u0026gt;;\n}\u0026gt;({ state: initialState });\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe problem of course is that you know you\u0026#39;re going to get yelled at for not having \u003ccode\u003edispatch\u003c/code\u003e just yet.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"_attachments/Pasted%20image%2020221111145603.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eOne option is to make \u003ccode\u003edispatch\u003c/code\u003e optional, but then you\u0026#39;re going to have to confirm it\u0026#39;s existence \u003cem\u003eevery\u003c/em\u003e time you use it—and that \u003cem\u003enot\u003c/em\u003e ideal.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst ColorContext = createContext\u0026lt;{\n  state: ColorState;\n  dispatch?: Dispatch\u0026lt;ColorActions\u0026gt;;\n}\u0026gt;({ state: initialState });\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe\u0026#39;re going to arrive at a slightly better solution in a bit, but we need to learn a few more things. But, one option is that since we \u003cem\u003eknow\u003c/em\u003e that we\u0026#39;re immediately going to write up \u003ccode\u003edispatch\u003c/code\u003e (or, \u003ccode\u003euseState\u003c/code\u003e), we could tell TypeScript, \u0026quot;Hey, trust me, I know what I\u0026#39;m doing.\u0026quot;\u003c/p\u003e\n\u003ch2 id=\"ideas-that-i-am-not-willing-to-entertain\"\u003eIdeas that I am not willing to entertain\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eUsing \u003ccode\u003eany\u003c/code\u003e\u003c/strong\u003e: This will opt us out of the whole reason we\u0026#39;re using TypeScript in the first place.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"an-escape-hatch\"\u003eAn escape hatch\u003c/h2\u003e\n\u003cp\u003eThis is an escape hatch that should fill you with an icky feeling, but it\u0026#39;s mostly okay in this particular case. We can assert that an object meets a given type—even if TypeScript doesn\u0026#39;t think that it does.\u003c/p\u003e\n\u003cp\u003eWe did this already in \u003ccode\u003esrc/index.tsx\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst root = ReactDOM.createRoot(\n  document.getElementById(\u0026quot;root\u0026quot;) as HTMLElement\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eSee that \u003ccode\u003eas HTMLElement\u003c/code\u003e. Yea, like there is a chance that it\u0026#39;s not on the page. \u003ccode\u003edocument.getElementById()\u003c/code\u003e handles that telling you that it \u003cem\u003emight\u003c/em\u003e return \u003ccode\u003eundefined\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eBut, we \u003cem\u003eknow\u003c/em\u003e it\u0026#39;s on the page, so we told TypeScript that it\u0026#39;s cool. We can do the same thing here too.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003econst ColorContext = createContext({ state: initialState } as {\n  state: ColorState;\n  dispatch: Dispatch\u0026lt;ColorActions\u0026gt;;\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003c!-- If this bother's you, we'll look at [a different—and arguably, better—way](createContext.md) to deal with this after we explore [generics](Generics.md) in a bit. --\u003e\n\n\u003cp\u003eNow, we can go the rest of the way with the normal ceremony that we\u0026#39;re used to.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-ts\"\u003eimport { createContext, Dispatch, PropsWithChildren, useReducer } from \u0026quot;react\u0026quot;;\nimport colorReducer, { initialState } from \u0026quot;./lib/color-reducer\u0026quot;;\n\nexport const ColorContext = createContext({ state: initialState } as {\n  state: ColorState;\n  dispatch: Dispatch\u0026lt;ColorActions\u0026gt;;\n});\n\nexport const ColorProvider = ({ children }: PropsWithChildren) =\u0026gt; {\n  const [state, dispatch] = useReducer(colorReducer, initialState);\n\n  return (\n    \u0026lt;ColorContext.Provider value={{ state, dispatch }}\u0026gt;\n      {children}\n    \u0026lt;/ColorContext.Provider\u0026gt;\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eDon\u0026#39;t forget to wrap your application in\u003c/p\u003e\n\u003cp\u003eThe important thing to note is that despite our sneaky move, our type system holds up. We don\u0026#39;t have to verify that \u003ccode\u003edispatch\u003c/code\u003e exists constantly and when we go to use \u003ccode\u003estate\u003c/code\u003e and \u003ccode\u003edispatch\u003c/code\u003e, everything will have the correct types.\u003c/p\u003e\n\u003ch2 id=\"using-the-context-in-your-components\"\u003eUsing the context in your components\u003c/h2\u003e\n\u003cp\u003eAnd again, we get a lot of the types for free. Let\u0026#39;s take it for a spin in \u003ccode\u003esrc/components/shared/color-change-swatch.tsx\u003c/code\u003e.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003eimport clsx from \u0026quot;clsx\u0026quot;;\nimport { MouseEventHandler, useContext } from \u0026quot;react\u0026quot;;\nimport { ColorContext } from \u0026quot;../../context\u0026quot;;\nimport Button from \u0026quot;./button\u0026quot;;\n\ntype ColorChangeSwatchProps = {\n  hexColor: string;\n  className?: string;\n  onClick?: MouseEventHandler\u0026lt;HTMLButtonElement\u0026gt;;\n};\n\nconst ColorChangeSwatch = ({\n  hexColor,\n  className,\n  onClick,\n}: ColorChangeSwatchProps) =\u0026gt; {\n  const { dispatch } = useContext(ColorContext);\n\n  return (\n    \u0026lt;Button\n      className={clsx(\n        \u0026quot;border-2 border-slate-900 transition-shadow duration-200 ease-in hover:shadow-xl\u0026quot;,\n        className\n      )}\n      style={{ backgroundColor: hexColor }}\n      onClick={() =\u0026gt;\n        dispatch({ type: \u0026quot;update-hex-color\u0026quot;, payload: { hexColor } })\n      }\n    \u0026gt;\n      {hexColor}\n    \u0026lt;/Button\u0026gt;\n  );\n};\n\nexport default ColorChangeSwatch;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can and should unwind the passing through of the \u003ccode\u003eonClick\u003c/code\u003e prop, but it\u0026#39;s not bothering anyone for now and I\u0026#39;ll probably just do that behind the seens as not to waste your precious time.\u003c/p\u003e\n\u003ch2 id=\"wiring-up-our-new-state\"\u003eWiring up our new state\u003c/h2\u003e\n\u003cp\u003eNow, it both works and it doesn\u0026#39;t work at the same time. It totally works, but \u003ccode\u003esrc/components/application.tsx\u003c/code\u003e is using a \u003cem\u003edifferent\u003c/em\u003e reducer right now.\u003c/p\u003e\n\u003cp\u003eThis is an easy fix:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003econst Application = () =\u0026gt; {\n  const { state, dispatch } = useContext(ColorContext);\n  const hexColor = state.hexColor;\n\n  return (\n    \u0026lt;div className=\u0026quot;grid max-w-3xl grid-cols-1 gap-8 p-8 pb-40 mx-auto dark:bg-slate-900 dark:text-white sm:grid-cols-2\u0026quot;\u0026gt;\n      \u0026lt;ColorPicker\n        hexColor={hexColor}\n        onChange={(e) =\u0026gt;\n          dispatch({\n            type: \u0026quot;update-hex-color\u0026quot;,\n            payload: { hexColor: e.target.value },\n          })\n        }\n      /\u0026gt;\n      \u0026lt;AdjustColors hexColor={hexColor} dispatch={dispatch} /\u0026gt;\n      \u0026lt;RelatedColors hexColor={hexColor} /\u0026gt;\n      \u0026lt;SavedColors hexColor={hexColor} dispatch={dispatch} /\u0026gt;\n    \u0026lt;/div\u0026gt;\n  );\n};\n\u003c/code\u003e\u003c/pre\u003e\n","markdown":"# **Context Api**\n\nAt first glance, React's Context API behaves just like we might expect.\n\n```tsx\nimport { createContext } from \"react\";\nimport { initialState } from \"./lib/color-reducer\";\n\nconst ColorContext = createContext(initialState);\n```\n\nIf you hover over `ColorContext`, you'll see:\n\n```tsx\nconst ColorContext: React.Context\u003cColorState\u003e;\n```\n\nAnd if you _just_ needed that you'd be fine.\n\n![](_attachments/Pasted%20image%2020221111145036.png)\n\nThe problem is that a lot of the time we use the Context APi to help with state management. And part of state management is—you know—updating the state.\n\nAnd to update the state, you tend to use hooks. And you definitely don't have those hooks outside of components.\n\nThe is futher exacerbated by the fact that you can only export `ColorContext` from the top-level of the module (e.g. _not_ inside a component where you can use hooks).\n\nAnd so, it's a bit tempting to say that we want to do something like this:\n\n```tsx\nconst ColorContext = createContext\u003c{\n  state: ColorState;\n  dispatch: Dispatch\u003cColorActions\u003e;\n}\u003e({ state: initialState });\n```\n\nThe problem of course is that you know you're going to get yelled at for not having `dispatch` just yet.\n\n![](_attachments/Pasted%20image%2020221111145603.png)\n\nOne option is to make `dispatch` optional, but then you're going to have to confirm it's existence _every_ time you use it—and that _not_ ideal.\n\n```tsx\nconst ColorContext = createContext\u003c{\n  state: ColorState;\n  dispatch?: Dispatch\u003cColorActions\u003e;\n}\u003e({ state: initialState });\n```\n\nWe're going to arrive at a slightly better solution in a bit, but we need to learn a few more things. But, one option is that since we _know_ that we're immediately going to write up `dispatch` (or, `useState`), we could tell TypeScript, \"Hey, trust me, I know what I'm doing.\"\n\n## Ideas that I am not willing to entertain\n\n- **Using `any`**: This will opt us out of the whole reason we're using TypeScript in the first place.\n\n## An escape hatch\n\nThis is an escape hatch that should fill you with an icky feeling, but it's mostly okay in this particular case. We can assert that an object meets a given type—even if TypeScript doesn't think that it does.\n\nWe did this already in `src/index.tsx`\n\n```tsx\nconst root = ReactDOM.createRoot(\n  document.getElementById(\"root\") as HTMLElement\n);\n```\n\nSee that `as HTMLElement`. Yea, like there is a chance that it's not on the page. `document.getElementById()` handles that telling you that it _might_ return `undefined`.\n\nBut, we _know_ it's on the page, so we told TypeScript that it's cool. We can do the same thing here too.\n\n```ts\nconst ColorContext = createContext({ state: initialState } as {\n  state: ColorState;\n  dispatch: Dispatch\u003cColorActions\u003e;\n});\n```\n\n\u003c!-- If this bother's you, we'll look at [a different—and arguably, better—way](createContext.md) to deal with this after we explore [generics](Generics.md) in a bit. --\u003e\n\nNow, we can go the rest of the way with the normal ceremony that we're used to.\n\n```ts\nimport { createContext, Dispatch, PropsWithChildren, useReducer } from \"react\";\nimport colorReducer, { initialState } from \"./lib/color-reducer\";\n\nexport const ColorContext = createContext({ state: initialState } as {\n  state: ColorState;\n  dispatch: Dispatch\u003cColorActions\u003e;\n});\n\nexport const ColorProvider = ({ children }: PropsWithChildren) =\u003e {\n  const [state, dispatch] = useReducer(colorReducer, initialState);\n\n  return (\n    \u003cColorContext.Provider value={{ state, dispatch }}\u003e\n      {children}\n    \u003c/ColorContext.Provider\u003e\n  );\n};\n```\n\nDon't forget to wrap your application in\n\nThe important thing to note is that despite our sneaky move, our type system holds up. We don't have to verify that `dispatch` exists constantly and when we go to use `state` and `dispatch`, everything will have the correct types.\n\n## Using the context in your components\n\nAnd again, we get a lot of the types for free. Let's take it for a spin in `src/components/shared/color-change-swatch.tsx`.\n\n```tsx\nimport clsx from \"clsx\";\nimport { MouseEventHandler, useContext } from \"react\";\nimport { ColorContext } from \"../../context\";\nimport Button from \"./button\";\n\ntype ColorChangeSwatchProps = {\n  hexColor: string;\n  className?: string;\n  onClick?: MouseEventHandler\u003cHTMLButtonElement\u003e;\n};\n\nconst ColorChangeSwatch = ({\n  hexColor,\n  className,\n  onClick,\n}: ColorChangeSwatchProps) =\u003e {\n  const { dispatch } = useContext(ColorContext);\n\n  return (\n    \u003cButton\n      className={clsx(\n        \"border-2 border-slate-900 transition-shadow duration-200 ease-in hover:shadow-xl\",\n        className\n      )}\n      style={{ backgroundColor: hexColor }}\n      onClick={() =\u003e\n        dispatch({ type: \"update-hex-color\", payload: { hexColor } })\n      }\n    \u003e\n      {hexColor}\n    \u003c/Button\u003e\n  );\n};\n\nexport default ColorChangeSwatch;\n```\n\nWe can and should unwind the passing through of the `onClick` prop, but it's not bothering anyone for now and I'll probably just do that behind the seens as not to waste your precious time.\n\n## Wiring up our new state\n\nNow, it both works and it doesn't work at the same time. It totally works, but `src/components/application.tsx` is using a _different_ reducer right now.\n\nThis is an easy fix:\n\n```tsx\nconst Application = () =\u003e {\n  const { state, dispatch } = useContext(ColorContext);\n  const hexColor = state.hexColor;\n\n  return (\n    \u003cdiv className=\"grid max-w-3xl grid-cols-1 gap-8 p-8 pb-40 mx-auto dark:bg-slate-900 dark:text-white sm:grid-cols-2\"\u003e\n      \u003cColorPicker\n        hexColor={hexColor}\n        onChange={(e) =\u003e\n          dispatch({\n            type: \"update-hex-color\",\n            payload: { hexColor: e.target.value },\n          })\n        }\n      /\u003e\n      \u003cAdjustColors hexColor={hexColor} dispatch={dispatch} /\u003e\n      \u003cRelatedColors hexColor={hexColor} /\u003e\n      \u003cSavedColors hexColor={hexColor} dispatch={dispatch} /\u003e\n    \u003c/div\u003e\n  );\n};\n```\n","slug":"the-context-api","title":"The Context Api","section":"Context Api","icon":"copyright","filePath":"/home/runner/work/React-with-TypeScript/React-with-TypeScript/lessons/07-context-api/A-the-context-api.md","nextSlug":"/React-with-TypeScript/lessons/context-api/context-api-exercise","prevSlug":"/React-with-TypeScript/lessons/Reducers/Typing-action-and-reducers-solution"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"context-api","slug":"the-context-api"},"buildId":"PALjGKd3AshwdXjsrKNVy","assetPrefix":"/React-with-TypeScript","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>